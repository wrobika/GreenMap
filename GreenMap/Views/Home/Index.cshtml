@{
    ViewData["Title"] = "Home Page";
    await Html.RenderPartialAsync("_NavigationBar");
    var epionierDbContext = new epionierContext();
    var zielenController = new GreenMap.Controllers.ZielenController(epionierDbContext);
    var cbdhController = new GreenMap.Controllers.CbdhObjController(epionierDbContext);
    var hydroController = new GreenMap.Controllers.HydroController(epionierDbContext);
    var dzielniceController = new GreenMap.Controllers.DzielniceController(epionierDbContext);
    var miastoController = new GreenMap.Controllers.GraniceMiastaController(epionierDbContext);
    var odwiertController = new GreenMap.Controllers.OdwiertController(epionierDbContext);
    var zwierciadloController = new GreenMap.Controllers.ZwierciadloGlController(epionierDbContext);
    var greenery = await zielenController.GetZielen();
    var objects = await cbdhController.GetCbdhObj();
    var hydro = await hydroController.GetHydro();
    var districts = await dzielniceController.GetDzielnice();
    var city = await miastoController.GetGraniceMiasta();
    var drilling = await odwiertController.GetOdwiert();
    var mirror = await zwierciadloController.GetZwierciadloGlebokosc();
    var layersProperties = LayersProperties.Layers;
}
<script src="~/lib/createLayers.js"></script>
<script src="~/lib/searchFunctions.js"></script>
<script type="text/javascript">

    var container = document.getElementById('popup');
    var content = document.getElementById('popup-content');
    var closer = document.getElementById('popup-closer');

    var overlay = new ol.Overlay({
        element: container,
        autoPan: true,
        autoPanAnimation: {
            duration: 250
        }
    });

    closer.onclick = function() {
        overlay.setPosition(undefined);
        closer.blur();
        return false;
    };

    var layerProperties = @Html.Raw(Json.Serialize(layersProperties));

    var layerObjects = {
        'miasto': @Html.Raw(Json.Serialize(city)),
        'dzielnice': @Html.Raw(Json.Serialize(districts)),
        'zieleń':@Html.Raw(Json.Serialize(greenery)),
        'cieki/zbiorniki': @Html.Raw(Json.Serialize(hydro)),
        'zwierciadło': @Html.Raw(Json.Serialize(mirror)),
        'obiekty': @Html.Raw(Json.Serialize(objects)),
        'odwierty': @Html.Raw(Json.Serialize(drilling)),
    };

    var background = new ol.layer.Tile({
        name: 'mapa',
        source: new ol.source.OSM()
    });

    var wms = new ol.layer.Tile({
        name: 'wms',
        source: new ol.source.TileWMS({
            url: 'https://ahocevar.com/geoserver/wms',
            params: { 'LAYERS': 'topp:states', 'TILED': true },
        })
    });

    var layers = [background, wms];
    Object.keys(layerObjects).map(layerName => layers.push(getLayer(layerName)));

    var map = new ol.Map({
        layers: layers,
        target: 'map',
        overlays: [overlay],
        view: new ol.View({
            center: ol.proj.fromLonLat([19.978618, 50.060601]),
            zoom: 12
        })
    });

    function changeVisibility() {
        var layerName = this.value;
        var button = this;
        var img = document.getElementById('eye_' + layerName);
        map.getLayers().forEach(function (layer) {
            if (layer.get('name') === layerName) {
                var isVisible = layer.get('visible');
                layer.setVisible(!isVisible);
                if (isVisible) {
                    button.className = 'dropdown-item text-black bg-light';
                    button.style = 'color:black';
                    img.src = '@Url.Content("~/css/eye_closed.png")';
                } else {
                    button.className = 'dropdown-item';
                    button.style = 'background-color:' + layerProperties[layerName].color
                        + ';opacity:' + layerProperties[layerName].opacity
                        + ';color:' + layerProperties[layerName].text;
                    img.src = '@Url.Content("~/css/eye.png")';
                }
            }
        });
    }

    let buttons = document.querySelectorAll('.dropdown-item')
    buttons.forEach((btn) => {
        btn.addEventListener("click", changeVisibility);
    });
</script>
<script src="~/lib/mapInteraction.js"></script>